(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{137:function(t,n,r){"use strict";r.d(n,"a",(function(){return e})),r.d(n,"b",(function(){return u}));var i=r(21),e=function(){return function(t){void 0===t&&(t={}),u(this,t)}}();function u(t,n,r){void 0===r&&(r=!1),Object(i.l)(t,"__nerve__",n,r)}},21:function(t,n,r){"use strict";r.d(n,"l",(function(){return e})),r.d(n,"m",(function(){return u})),r.d(n,"n",(function(){return c})),r.d(n,"o",(function(){return o})),r.d(n,"j",(function(){return s})),r.d(n,"i",(function(){return f})),r.d(n,"q",(function(){return h})),r.d(n,"k",(function(){return a})),r.d(n,"g",(function(){return l})),r.d(n,"h",(function(){return v})),r.d(n,"a",(function(){return d})),r.d(n,"b",(function(){return O})),r.d(n,"d",(function(){return b})),r.d(n,"e",(function(){return j})),r.d(n,"c",(function(){return m})),r.d(n,"p",(function(){return g})),r.d(n,"f",(function(){return y}));var i=r(30);function e(t,n,r,i){void 0===i&&(i=!0),w(t,n,{configurable:!1,enumerable:!!i,value:r,writable:!1})}function u(t,n,r){w(t,n,{configurable:!0,enumerable:!0,get:function(){var i=r();return delete t[n],e(t,n,i),i},set:function(){throw Error("Setting readonly field: "+n)}})}function c(t,n,r,i){w(t,n,{configurable:!1,enumerable:!0,get:r,set:i=i||function(){throw Error("Setting readonly field: "+n)}})}function o(t,n){var r=t;for(var i in n)r[i]=n[i];return r}function s(t){return o({},t)}function f(t){Object(i.a)(!Array.isArray(t),"array is not currently supported by readonly().");var n={};for(var r in t)e(n,r,t[r]);return n}function h(t,n){Object(i.a)(n in t,"the field named "+n+" not been initialized yet."),e(t,n,t[n])}function a(t){return Array.isArray(t)?t:function(t){return t?Array.prototype.slice.apply(t):[]}(t)}function l(t){var n=function(){return Promise.resolve(null)};return t?t.then(n,n):n()}function v(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return new Promise((function(n,r){var i=t.length,e=[];t.forEach((function(t,u){return t.then((function(t){return n(t)})).catch((function(t){e[u]=t,0==--i&&r.apply(void 0,e)}))}))}))}var b,d=function(){function t(t,n){void 0===n&&(n=0),this.t=t,this.u=n}var n=t.prototype;return n.callOnceLater=function(){var t=this;0!==this.u&&null!=this.s&&this.clear(),null==this.s&&(this.s=window.setTimeout((function(){t.callImmediately()}),this.u))},n.flush=function(){null!=this.s&&(this.clear(),this.t())},n.callImmediately=function(){null!=this.s&&this.clear(),this.t()},n.clear=function(){this.s&&(clearTimeout(this.s),this.s=void 0)},t}(),O=function(){function t(t){var n=this;this.v=new Promise((function(r,i){t.then((function(){n.O||r()}),(function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];n.O||i(t)}))}))}var n=t.prototype;return n.promise=function(){return this.v},n.cancel=function(){this.O=!0},t}();!function(t){t[t.Pending=0]="Pending",t[t.Resolved=1]="Resolved",t[t.Rejected=2]="Rejected"}(b||(b={}));var j=function(){function t(t,n){var r=this;void 0===n&&(n=b.Pending),t.then((function(){r.S=b.Resolved}),(function(){r.S=b.Rejected})),this.I=t,this.S=n}var n=t.prototype;return n.promise=function(){return this.I},n.states=function(){return this.S},t}(),m=function(){function t(){var t=this;this.I=new j(new Promise((function(n,r){t.F=n,t.P=r})))}var n=t.prototype;return n.promise=function(){return this.I.promise()},n.resolve=function(){return this.F(),this},n.reject=function(t){return this.P(t),this},n.states=function(){return this.I.states()},t}();function g(){return(new m).resolve()}function w(t,n,r){try{Object.defineProperty(t,n,r)}catch(t){var e=t&&t.message||"(no message)";Object(i.b)('Failed to set property "'+n+'": '+e)}}function y(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=[];return t.forEach((function(t){t&&t.then?r.push(t):r.push(Promise.resolve(t))})),Promise.all(r)}},30:function(t,n,r){"use strict";function i(t,n){t||(console.assert(t,"Nerve - "+n),s("assert failed: "+n))}function e(t){return s("TODO: "+t)}function u(){return s("to be overridden.")}function c(t){if(t="Nerve - warning: "+t,console.warn(t),o){var n=new Error(t).stack;o(n)}}r.d(n,"a",(function(){return i})),r.d(n,"d",(function(){return e})),r.d(n,"c",(function(){return u})),r.d(n,"e",(function(){return c})),r.d(n,"b",(function(){return s}));var o=null;function s(t){throw Error("Nerve - "+t)}},4:function(t,n,r){"use strict";r.d(n,"c",(function(){return f})),r.d(n,"d",(function(){return h})),r.d(n,"b",(function(){return a})),r.d(n,"a",(function(){return j}));var i=r(6),e=r(30),u=r(137),c=r(21),o=Object.freeze({IsKeyField:!1,IsLocalField:!1,IsNumberTypeInDataSource:!1,IsSourceGenerated:!1});function s(t,n){var r=l();if(i.a.isObjectMasterClass(t))r.masterClassGetter=function(){return t};else{if(!(t instanceof Function))throw Error("The parameter of Spec.fromMasterClass should be a master class of a function.");r.masterClassGetter=t}return v(r,n)}function f(t){var n=t;return n&&n.__nerve__&&"Spec"===n.__nerve__.nerveObjectType}function h(t,n){n?Object.keys(n).forEach((function(r){return function t(n,r){r?f(r)?r.__nerve__.isCollection&&t(n+"[0]",r[0]):h(n,r):d(n,"empty field spec")}(t+r,n[r])})):d(t,"there's no spec passed")}function a(t){return f(t)?t.__nerve__.attributes:o}function l(){return{attributes:o,basicTypeName:null,enumTypeGetter:null,isCollection:!1,isLeaf:!1,keyGetter:null,masterClassGetter:null,nullable:!1,nerveObjectType:"Spec"}}function v(t,n){var r={};return b(t,n),Object(u.b)(r,Object(c.i)(t)),r}function b(t,n){if((n=n||{}).IsKeyField){switch(t.basicTypeName){case"boolean":case"string":case"number":break;default:Object(e.b)('"isKeyField" only supported for basic type fields')}n.IsLocalField&&Object(e.b)("a local field can't be key field.")}var r={IsSourceGenerated:!!n.IsSourceGenerated,IsExpandedField:!!n.IsExpandedField,IsKeyField:!!n.IsKeyField,IsLocalField:!!n.IsLocalField,IsNumberTypeInDataSource:!!n.IsNumberTypeInDataSource,SourceFieldName:n.SourceFieldName};t.attributes=Object.freeze(r)}function d(t,n){throw Error("Spec error of "+t+": "+n+".")}function O(t){return function(n,r){return function(t,n,r){var i=l();return i.isLeaf=!0,i.basicTypeName=t,i.keyGetter=r||null,b(i,n),v(i,n)}(t,n,r)}}var j=Object.freeze({create:function(t,n){var r;return b(r=f(t)?Object(c.j)(t.__nerve__):l(),n),Object(c.o)(v(r,n),t)},boolean:O("boolean"),number:O("number"),string:O("string"),enumeration:function(t,n){var r=l();return r.isLeaf=!0,r.basicTypeName="enum",r.enumTypeGetter=t,b(r,n),v(r,n)},reference:O("reference"),collectionOf:function(t,n){var r;r=f(t)?t:i.a.isObjectMasterClass(t)||t instanceof Function?s(t):t;var e=l();e.isCollection=!0;var u=v(e,n);return Object(c.l)(u,0,r),u},fromMasterClass:s})},6:function(t,n,r){"use strict";r.d(n,"a",(function(){return pt}));var i=r(2),e=r(30),u=function(){function t(n){n instanceof t?this.C(n.M):this.N(n)}var n=t.prototype;return Object.defineProperty(n,"Count",{get:function(){return this.M.fieldCount},enumerable:!1,configurable:!0}),n.has=function(t){return this.hasId(rt(t))},n.hasId=function(t){return!!this.M.map[t]},n.intersect=function(t){if(Array.isArray(t))return t.some(this.has.bind(this));var n=this,r=t;if(r.Count<n.Count){var i=n;n=r,r=i}for(var e in n.M.map)if(r.M.map[e])return!0;return!1},n.intersection=function(n){var r=this;if(Array.isArray(n))return new t(n.filter((function(t){return $(t)&&r.has(t)})));if(n instanceof t){var i=this,e=n;if(e.Count<i.Count){var u=i;i=e,e=u}var c=new t;for(var o in i.M.map)e.hasId(o)&&c.addFieldSchema(ut(o));return c}return new t},n.toArray=function(){return Object.keys(this.M.map).map(ut)},n.clone=function(){return new t(this)},n.clear=function(){this.N()},n.addFieldSchema=function(t){this.has(t)||(this.D(),this.T(t))},n.addFieldSchemas=function(n){var r,i=this;(r=(r=n instanceof t?n.toArray():n).filter((function(t){return!i.has(t)}))).length&&(this.D(),this.T.bind(this),r.forEach((function(t){return i.T(t)})))},n.removeFieldSchema=function(t){this.has(t)&&(this.D(),this.A(t))},n.removeFieldSchemas=function(n){var r,i=this;(r=(r=n instanceof t?n.toArray():n).filter((function(t){return i.has(t)}))).length&&(this.D(),r.forEach((function(t){return i.A(t)})))},n.D=function(){1!==this.M.referenceCount&&this.N(this.toArray())},n.T=function(t){var n=rt(t);this.M.map[n]||(this.M.map[n]=!0,++this.M.fieldCount)},n.A=function(t){var n=rt(t);this.M.map[n]&&(delete this.M.map[n],--this.M.fieldCount)},n.N=function(t){this.C({map:{},fieldCount:0,referenceCount:0}),t&&this.addFieldSchemas(t)},n.C=function(t){this.M&&--this.M.referenceCount,this.M=t,++this.M.referenceCount},t}(),c=r(137),o=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return Object(i.__extends)(n,t),n.prototype.toJSON=function(){return this.__nerve__.master.getSnapshot()},n}(c.a),s=r(21);function f(t){if(t instanceof o)return t.__nerve__.master;Object(e.b)("Invalid parameter: please use '<your master>.Model.*' for the parameter.")}function h(t){return function(t){if(t instanceof a)return t.constructor;Object(e.b)("the parameter is not a nerve master object.")}(t).__nerve__.masterName}var a=function(t){function n(n){var r=t.call(this)||this,i=r.__nerve__,e=n&&n.Reserved&&n.Reserved.Membership;e&&(i.membership=Object(s.i)(e),Object(s.q)(i,"membership"));var u=!1;return Object(s.n)(i,"deleted",(function(){return u}),(function(t){if(!u&&t){u=!0,i.dirtyChecker.updateDirtiness();var n=i.changeManager;n.startBulkEditMode(),i.markChildrenAsDeleted(),n.markAsDeleted(),n.endBulkEditMode()}})),i.instanceId=(++l).toString(),Object(s.q)(i,"instanceId"),r}Object(i.__extends)(n,t);var r=n.prototype;return Object.defineProperty(r,"Schema",{get:function(){return Object(e.c)()},enumerable:!1,configurable:!0}),Object.defineProperty(r,"Model",{get:function(){return this.__nerve__.model},set:function(t){this.setData(t,this.Schema.__nerve__.subFields.toArray())},enumerable:!1,configurable:!0}),Object.defineProperty(r,"Parent",{get:function(){var t=this.__nerve__.membership;return t&&t.Parent},enumerable:!1,configurable:!0}),Object.defineProperty(r,"Membership",{get:function(){var t=this.__nerve__.membership;return{Parent:t&&t.Parent,FieldSchema:t&&t.FieldSchema}},enumerable:!1,configurable:!0}),Object.defineProperty(r,"Deleted",{get:function(){return this.__nerve__.deleted},set:function(t){this.__nerve__.deleted=t},enumerable:!1,configurable:!0}),r.getInstanceId=function(){return this.__nerve__.instanceId},r.getSnapshot=function(t){return this.__nerve__.changeManager.getSnapshot(t)},r.bulkEdit=function(t){var n=this.__nerve__.changeManager;n&&n.startBulkEditMode();try{return t(this.Model)}finally{n&&n.endBulkEditMode()}},r.observe=function(t,n){return this.__nerve__.changeManager.observe(t,n)},r.unobserve=function(t,n){return this.__nerve__.changeManager.unobserve(t,n)},r.addRule=function(t){return this.__nerve__.changeManager.addRule(t)},r.removeRule=function(t){return this.__nerve__.changeManager.removeRule(t)},n}(c.a),l=0,v=function(){function t(t){this.R=t,this.K=[],this.G=0,this.U=Object(s.p)(),this.L=new s.a(this.V.bind(this)),this._=[],this.initializeSnapshot(),this.resetChangeInfo()}var n=t.prototype;return n.getSnapshot=function(t){if(!this.B){for(var n in this.J)this.refreshSubSnapshot(this.J[n]);this.J={},this.B=this.createSnapshotCache()}return this.B},n.definitelyMarkAsChanged=function(t){this.W=!0,this.markAsChanged(t)},n.markAsChanged=function(t,n){this.H();var r=t.FieldSchema,i=new u([r]);if(this.X.addFieldSchema(r),n){this.Y.push(n);var e=n.FieldSchemas.map(r.__nerve__.shadowMapper);i.addFieldSchemas(e)}this.markFieldsAsChanged(i)},n.markAsDeleted=function(){this.markFieldsAsChanged([this.R.Schema])},n.startBulkEditMode=function(){++this.G},n.endBulkEditMode=function(){--this.G<=0&&(this.G=0,this.L.flush())},n.observe=function(t,n){var r=this.K[this.Z(t)];r?n?r.fieldSet.addFieldSchemas(n):r.fieldSet=this.$().clone():this.K.push({callback:t,fieldSet:new u(n||this.$())})},n.unobserve=function(t,n){var r=this.Z(t),i=this.K[r];i&&(n?n.forEach((function(t){i.fieldSet.removeFieldSchemas(t.__nerve__.allContainedFields)})):i.fieldSet.clear(),0===i.fieldSet.Count&&this.K.splice(r,1))},n.addRule=function(t){this._.indexOf(t)<0&&this._.push(t)},n.removeRule=function(t){var n=this._.indexOf(t);n>=0&&this._.splice(n,1)},n.markSubSnapshotAsDirty=function(t){var n=this;if(t.length){this.B=void 0,t.forEach((function(t){return n.J[t.Name]=t}));var r=this.Master.__nerve__.membership,i=r&&r.Parent.__nerve__.changeManager;i&&i.markSubSnapshotAsDirty([r.Property])}},n.getChangingPeriod=function(){return this.U.promise()},Object.defineProperty(n,"Master",{get:function(){return this.R},enumerable:!1,configurable:!0}),n.createChange=function(t){var n=this.Master.__nerve__.deleted&&!this.tt;return{BeingDeleted:n,DefinitelyMarked:this.W,FieldSchemas:Object.freeze(t.toArray()),Master:this.Master,NewValues:n?null:this.getSnapshot(),OldValues:this.nt,SubChanges:Object.freeze(this.Y),UpdateNeeded:n}},n.resetChangeInfo=function(){this.X=new u,this.Y=[],this.nt=this.getSnapshot(),this.tt=this.R.Deleted,this.W=!1},n.notifyChangeIfNeed=function(){this.G>0?this.L.callOnceLater():this.L.callImmediately()},n.anythingChanged=function(){return this.X.Count>0||this.Master.__nerve__.deleted},n.markFieldsAsChanged=function(t,n){var r=this;this.X.addFieldSchemas(t),this.rt?this.it=!0:n?n.then((function(){return r.notifyChangeIfNeed()})):this.notifyChangeIfNeed()},n.shouldObserverBeNotified=function(t,n){return t.fieldSet.intersect(n.FieldSchemas)},n.removeUnchangedFields=function(t,n){},n.Z=function(t){for(var n=0;n<this.K.length;++n)if(this.K[n].callback===t)return n},n.V=function(){var t=this;if(this.et(),this.ut(),this.W||this.Master.Deleted||this.removeUnchangedFields(this.X,this.nt),this.anythingChanged()){var n=Object.freeze(this.createChange(this.X));this.resetChangeInfo();var r=this.Master.__nerve__.membership;if(r&&r.Property.Mounted){var i=r.Parent.__nerve__.changeManager;i&&i.markAsChanged(r.Property,n)}this.K.concat().forEach((function(r){t.shouldObserverBeNotified(r,n)&&r.callback(n)}))}},n.et=function(){var t=this;this.rt=!0;var n=0,r=this.X,i=this.Y,e=[],c=function(){var c=o._.filter((function(n){return!n.InterestedFields||t.X.intersect(n.InterestedFields)}));if(!c.length)return"break";if(++n>8*o._.length)return o.ct(e),"break";var s=o.X,f=o.Y;o.X=new u,o.Y=[];var h=o.Master.__nerve__.deleted&&!o.tt;c.forEach((function(n){t.it=!1,n.onChange({Master:t.Master,BeingDeleted:h,FieldSchemas:s.toArray(),OldValues:t.nt,SubChanges:f}),t.it&&e.push(n)})),r.addFieldSchemas(o.X),i.push.apply(i,o.Y)},o=this;do{if("break"===c())break}while(this.X.Count);this.rt=!1,this.X=r,this.Y=i},n.ct=function(t){Object(e.e)("following rules might do against each other: "+JSON.stringify(t.map((function(t){return t.Name})))+" (master: "+h(this.Master)+")")},n.$=function(){return this.Master.Schema.__nerve__.allContainedFields},n.H=function(){this.U.states()!==s.d.Pending&&(this.U=new s.c)},n.ut=function(){this.U.resolve()},t}(),b=function(){function t(t){this.ot=t}return t.prototype.updateDirtiness=function(){if(this.ot){var t=this.getProperty();t.ParentMaster.__nerve__.dirtyChecker.setMemberDirtiness(t.Name,this.isDirty())}},t}(),d=function(t){function n(n,r){var i=t.call(this,r)||this;return i.st=n,i}Object(i.__extends)(n,t);var r=n.prototype;return r.isDirty=function(){return this.ft!==this.convertModelToSourceData()},r.initializeSourceData=function(t){this.setSourceData(t)},r.getDelta=function(){return this.convertModelToSourceData()},r.getSnapshotToUpdate=function(){return this.convertModelToSourceData()},r.getSourceData=function(){return this.ft},r.setSourceData=function(t){void 0===t&&(t=null),this.ft=t,this.updateDirtiness()},r.onSourceDataReceived=function(t){var n=this.isDirty();this.setSourceData(t),n||this.st.setter(this.convertFromSourceData(t))},r.getProperty=function(){return this.st},r.convertModelToSourceData=function(){return this.st.getter()},r.convertFromSourceData=function(t){return t},n}(b),O=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}Object(i.__extends)(n,t);var r=n.prototype;return r.convertModelToSourceData=function(){return this.ht(this.getProperty().getter())},r.convertFromSourceData=function(t){return this.ht(t)},r.ht=function(t){return null==t?null:this.getProperty().FieldSchema.__nerve__.enumType[t]},n}(d),j=function(){function t(t,n,r){var i=this;this.at=t,this.lt=n;var e=r.Reserved.Membership;this.vt=e.Parent,e.Property=this,this.bt=!1,r.Reserved.Mounted.then((function(){return i.bt=!0}))}var n=t.prototype;return Object.defineProperty(n,"Name",{get:function(){return this.at},enumerable:!1,configurable:!0}),Object.defineProperty(n,"FieldSchema",{get:function(){return this.lt},enumerable:!1,configurable:!0}),Object.defineProperty(n,"ParentMaster",{get:function(){return this.vt},enumerable:!1,configurable:!0}),Object.defineProperty(n,"Index",{get:function(){return this.dt},set:function(t){if(t!==this.dt){var n=this.dt;this.dt=t;var r=this.ParentMaster;this.indexDirtinessUpdateNeeded()&&r.__nerve__.dirtyChecker.updateDirtinessForIndexChange(this),this.Mounted&&r.__nerve__.changeManager.onPropertyIndexChange(this,n)}},enumerable:!1,configurable:!0}),Object.defineProperty(n,"Mounted",{get:function(){return this.bt},enumerable:!1,configurable:!0}),Object.defineProperty(n,"Deleted",{get:function(){return this.Ot},enumerable:!1,configurable:!0}),Object.defineProperty(n,"ParentDirtyChecker",{get:function(){return this.ParentMaster.__nerve__.dirtyChecker},enumerable:!1,configurable:!0}),n.markAsDeleted=function(t){this.Ot=!0,this.Index=void 0},n.getKey=function(){return this.lt.__nerve__.getKey(this.getter())},t}(),m=function(t){function n(n,r,i){var e=t.call(this,n,r,i)||this;e.jt=e.normalizeValue(i.InitialData);var u=!r.__nerve__.info.Attributes.IsLocalField;return e.gt=e.createDirtyChecker(u),e}Object(i.__extends)(n,t);var r=n.prototype;return r.getter=function(){return this.jt},r.setter=function(t){if(t=this.normalizeValue(t),this.jt!==t){this.jt=t,this.gt.updateDirtiness();var n=this.ParentMaster.__nerve__.changeManager;n.markSubSnapshotAsDirty([this]),n.markAsChanged(this)}},r.getDirtyChecker=function(){return this.gt},r.normalizeValue=function(t){return null==t?null:t},r.createDirtyChecker=function(t){return new d(this,t)},r.indexDirtinessUpdateNeeded=function(){return!0},n}(j),g=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}Object(i.__extends)(n,t);var r=n.prototype;return r.normalizeValue=function(t){var n=typeof t;if("string"===n||"number"===n){var r=this.FieldSchema.__nerve__.enumType;if(t in r)return"string"===n?r[t]:t}return null},r.createDirtyChecker=function(t){return new O(this,t)},n}(m),w=r(4);function y(t){return t.__nerve__.info.IsLeaf}function p(t,n,r,i,e){var u=ht({enumTypeGetter:r.__nerve__.enumTypeGetter,getKeyForReferenceType:r.__nerve__.keyGetter,info:{Attributes:Object(w.b)(r),FieldId:t,IsLeaf:!0,IsCollection:!1,Name:i,Path:e||i},parentMasterClass:n,parentSchema:n.__nerve__.schema,withDataSource:!1});return u.__nerve__.generateProperty=function(t){return t.__nerve__.asEnum?function(n,r){return new g(n,t,r)}:function(n,r){return new m(n,t,r)}}(u),Object(s.q)(u.__nerve__,"generateProperty"),u}var S=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}Object(i.__extends)(n,t);var r=n.prototype;return r.markAsChanged=function(n,r){r&&r.BeingDeleted?this.Master.deleteItems([n.getter()]):t.prototype.markAsChanged.call(this,n,r)},r.onPropertiesAdded=function(t,n){t.length&&(this.wt=this.wt.concat(t),this.yt=void 0,this.markSubSnapshotAsDirty(t),this.markFieldsAsChanged(this.Master.Schema.__nerve__.allContainedFields,n))},r.onPropertiesRemoved=function(t,n){var r=this;t.length&&(t.forEach((function(t){var n=r.wt.indexOf(t);n>=0?r.wt.splice(n,1):r.pt.push(t),r.St[t.Name]&&(delete r.St[t.Name],--r.It)})),this.yt=void 0,this.markSubSnapshotAsDirty(t),this.markFieldsAsChanged(this.Master.Schema.__nerve__.allContainedFields,n))},r.onPropertyIndexChange=function(t,n){this.markSubSnapshotAsDirty([t]),this.St[t.Name]?this.St[t.Name].NewIndex=t.Index:(this.St[t.Name]={OldIndex:n,NewIndex:t.Index},++this.It),this.notifyChangeIfNeed()},r.initializeSnapshot=function(){y(this.Master.Schema[0])?this.Ft=n.getSubSnapshotForLeafContent:this.Ft=n.getSubSnapshotForMasterContent,this.Pt()},r.refreshSubSnapshot=function(t){this.yt&&!t.Deleted&&(this.yt[t.Index]=this.Ft(t.getter()))},r.createSnapshotCache=function(){return this.yt||this.Pt(),this.yt.concat()},r.createChange=function(n){var r=this,i=t.prototype.createChange.call(this,n),e=function(t){return t.getter()},u=function(t){return r.Ft(t)};i.AddedModels=Object.freeze(this.wt.map(e)),i.AddedItemsAsSnapshots=Object.freeze(i.AddedModels.map(u)),i.RemovedModels=Object.freeze(this.pt.map(e)),i.RemovedItemsAsSnapshots=Object.freeze(i.RemovedModels.map(u));var c={};Object.keys(this.St).forEach((function(t){var n=r.St[t];null!=n.NewIndex&&null!=n.OldIndex&&(c[n.NewIndex]=n.OldIndex)})),i.ChangedIndexMap=Object.freeze(c);var o=this.Master.Schema[0];return i.UpdateNeeded||o.__nerve__.info.Attributes.IsLocalField||(i.UpdateNeeded=i.AddedModels.length>0||i.RemovedModels.length>0||i.SubChanges.some((function(t){return t.UpdateNeeded}))),i},r.resetChangeInfo=function(){t.prototype.resetChangeInfo.call(this),this.wt=[],this.pt=[],this.St={},this.It=0},r.anythingChanged=function(){return this.wt.length>0||this.pt.length>0||this.It>0||t.prototype.anythingChanged.call(this)},r.shouldObserverBeNotified=function(n,r){return!!Object.keys(r.ChangedIndexMap).length||t.prototype.shouldObserverBeNotified.call(this,n,r)},r.Pt=function(){this.yt=[];for(var t=this.Master.Model,n=0;n<t.length;++n)this.yt[n]=this.Ft(t[n])},n.getSubSnapshotForLeafContent=function(t){return t},n.getSubSnapshotForMasterContent=function(t){return f(t).getSnapshot()},n}(v),I=function(t){function n(n,r,i){var e=t.call(this,i)||this;return e.Ct={},e.Mt=0,e.R=n,e.Nt=r,e}Object(i.__extends)(n,t);var r=n.prototype;return Object.defineProperty(r,"Master",{get:function(){return this.R},enumerable:!1,configurable:!0}),Object.defineProperty(r,"ExistingInSource",{get:function(){return this.Nt},set:function(t){this.Nt=t,this.updateDirtiness()},enumerable:!1,configurable:!0}),r.isDirty=function(){if(this.R.__nerve__.deleted){var t=this.Master.Parent;return!(t&&t.__nerve__.deleted)&&this.Nt}return 0!==this.Mt},r.setMemberDirtiness=function(t,n){!this.Ct[t]!=!n&&(n?(this.Ct[t]=!0,0==this.Mt++&&this.updateDirtiness()):(delete this.Ct[t],0==--this.Mt&&this.updateDirtiness()))},r.getDirtyKeys=function(){return Object.keys(this.Ct)},r.getProperty=function(){return this.R.__nerve__.membership.Property},n}(b),F=function(t){function n(n,r,i){var e=t.call(this,n,r,i)||this;return e.Dt([]),e}Object(i.__extends)(n,t);var r=n.prototype;return r.initializeSourceData=function(t){var n=this;this.Dt(t||[]),this.Tt().forEach((function(t){var r=t.getDirtyChecker(),i=n.ft[n.Et(t)];r.initializeSourceData(i)})),this.updateDirtinessForLength(this.Master.Model.length)},r.getDelta=function(){return Object(e.d)("get delta for collection is not supported yet.")},r.getSnapshotToUpdate=function(){return this.Tt().map((function(t){return t.getDirtyChecker()})).map((function(t){return t.getSnapshotToUpdate()}))},r.getSourceData=function(){return st(this.ft,this.Master.Schema)},r.setSourceData=function(t){this.setSourceDataInternal(t||[])},r.onSourceDataReceived=function(t){t=t||[],this.Dt(t),this.Master.Model.__nerve__.onSourceDataReceived(t),this.updateDirtinessForLength(this.Master.Model.length)},r.updateDirtinessForLength=function(t){this.setMemberDirtiness("length",t!==this.getSourceDataLength())},r.updateDirtinessForIndexChange=function(t){t.Deleted?this.setMemberDirtiness(t.Name,!1):t.getDirtyChecker().setSourceData(this.ft[t.Index])},r.getSourceDataLength=function(){return this.ft.length},r.setSourceDataInternal=function(t){var n=this;this.Dt(t),this.Tt().forEach((function(t){var r=t.getDirtyChecker(),i=n.Et(t);r.setSourceData(n.ft[i]),r instanceof I&&(r.ExistingInSource=i<n.ft.length)})),this.updateDirtinessForLength(this.Master.Model.length)},r.Tt=function(){return this.Master.Model.__nerve__.properties},r.Dt=function(t){var n=this;this.ft=t;var r=this.Master.Schema[0];r.__nerve__.withKey&&(this.kt={},t.map(r.__nerve__.getKeyFromSourceData).forEach((function(t,r){t&&(n.kt[t]=r)})))},r.Et=function(t){return this.Master.Schema[0].__nerve__.withKey?this.kt[t.getKey()]:t.Index},n}(I),P=function(t){function n(n,r){var i,e,u=this,c=n.Schema[0];c.__nerve__.withKey?(i=k,e=K):(i=c.__nerve__.info.IsLeaf?A:R,e=x);var o=r.Reserved&&r.Reserved.ParentExistingInDataSource;return(u=t.call(this,{master:n,keyToProperty:c.__nerve__.withKey?{}:null,initializedLength:0,newestPropertyName:0,masterTreeReady:r.MasterTreeReady,properties:[],addItems:function(t,n){return C(u,t,n,o)},deleteItems:function(t,n){return function(t,n,r){var i=t.__nerve__.properties.filter((function(t){var r=t.getter();return n.some((function(t){return t===r}))}));return D(t,i,r),i}(u,t,n)},setData:function(t){return i(u,t)},onSourceDataReceived:function(t){return e(u,t)},setComparer:function(t){u.__nerve__.comparer=t,u.__nerve__.propertyComparer=t&&function(n,r){return t(n.getter(),r.getter())},t&&E(u,u.__nerve__.propertyComparer)}})||this).ensureFieldsReadyPromiseChain=Promise.resolve([]),C(u,Object(s.k)(r.InitialData),r.ExistingInDataSource,o),u}Object(i.__extends)(n,t);var r=n.prototype;return Object.defineProperty(r,"length",{get:function(){return this.__nerve__.properties.length},enumerable:!1,configurable:!0}),n}(o);function C(t,n,r,i){var e=t.__nerve__.master,u=e.Schema[0],c=u.__nerve__.generateProperty,o=new s.c,f=Object(s.f)(t.__nerve__.masterTreeReady,o.promise()),h=n.map((function(n){return c((++t.__nerve__.newestPropertyName).toString(),{InitialData:n,ExistingInDataSource:r,MasterTreeReady:f,Reserved:{Membership:{Parent:e,FieldSchema:u},ParentExistingInDataSource:i,Mounted:o.promise()}})})),a=[t.ensureFieldsReadyPromiseChain];if(u.__nerve__.withKey){var l=t.__nerve__.keyToProperty;if(u.__nerve__.withDataSource){var v=u.__nerve__.keyFields.toArray();h.forEach((function(t){var n=t.Master;a.push(n.Synchronizer.ensureFieldsReady(v).then((function(){return M(l,t,!0)})))}))}h.forEach((function(t){return M(l,t)}))}var b=t.__nerve__.properties,d=b.length;return e.bulkEdit((function(){b.push.apply(b,h),function(t){var n=t.__nerve__,r=n.properties.length;for(;n.initializedLength<r;)N(t,n.initializedLength),++n.initializedLength}(t);for(var n=d;n<b.length;++n)b[n].Index=n;e.__nerve__.dirtyChecker.updateDirtinessForLength(b.length);var r=t.__nerve__.propertyComparer;r&&E(t,r),o.resolve();var i=e.__nerve__.changeManager,u=Promise.all(a);t.ensureFieldsReadyPromiseChain=u,i&&i.onPropertiesAdded(h,u)})),h}function M(t,n,r){void 0===r&&(r=!1);var i=n.getKey();if(i){if(i in t){if(r)return;Object(e.b)('duplicated key "'+i+'" at '+et(n.FieldSchema)+" is being added.")}t[i]=n}}function N(t,n){Object(s.n)(t,n,(function(){return n>=this.__nerve__.properties.length&&Object(e.b)("Get item out of range. Index: "+n+"; Length: "+this.__nerve__.properties.length),this.__nerve__.properties[n].getter()}),(function(t){n>=this.__nerve__.properties.length&&Object(e.b)("Set item out of range. Index: "+n+"; Length: "+this.__nerve__.properties.length),this.__nerve__.properties[n].setter(t)}))}function D(t,n,r){var i=n.length;if(i>0){var e=t.__nerve__.properties,u=e.length,c=t.__nerve__.master;c.bulkEdit((function(){for(;i>0;--i){for(var o=n[i-1];--u>o.Index;)e[u].Index-=i;e.splice(u,1),o.markAsDeleted(r)}var s=c.Schema[0],f=[t.ensureFieldsReadyPromiseChain];if(s.__nerve__.withKey){var h=t.__nerve__.keyToProperty;if(s.__nerve__.withDataSource){var a=s.__nerve__.keyFields.toArray();n.forEach((function(t){var n=t.Master;f.push(n.Synchronizer.ensureFieldsReady(a).then((function(){return T(h,t)})))}))}n.forEach((function(t){return T(h,t)}))}var l=Promise.all(f);t.ensureFieldsReadyPromiseChain=l,c.__nerve__.dirtyChecker.updateDirtinessForLength(e.length),c.__nerve__.changeManager.onPropertiesRemoved(n,l)}))}}function T(t,n){var r=n.getKey();r&&r in t&&n===t[r]&&delete t[r]}function E(t,n){n&&t.__nerve__.properties.sort(n),t.__nerve__.master.bulkEdit((function(){t.__nerve__.properties.forEach((function(t,n){t.Index=n}))}))}function k(t,n){var r=t.__nerve__.master,i=t.__nerve__.master.Schema[0],e=t.__nerve__.properties,u={};n.map(i.__nerve__.getKey).forEach((function(t,n){return u[t]=n}));var c={};e.forEach((function(t){return c[t.getKey()]=t}));var o={};r.bulkEdit((function(){var r=[];for(var i in u){var e=u[i];if(i in c){var s=c[i];s.setter(n[e]),o[s.Name]=e,delete c[i]}else r.push(e)}var f=[];for(var i in c)f.push(c[i]);f.length&&(f.sort((function(t,n){return t.Index-n.Index})),D(t,f,!1)),r.length&&t.__nerve__.addItems(r.map((function(t){return n[t]})),!1).forEach((function(t,n){return o[t.Name]=r[n]}));var h=function(t,n){return o[t.Name]-o[n.Name]},a=t.__nerve__.propertyComparer;E(t,a?function(t,n){return a(t,n)||h(t,n)}:h)}))}function A(t,n){for(var r=t.__nerve__.master,i={},u=Object(s.k)(t.__nerve__.master.getSnapshot()).slice(),c=[],o={},f=0;f<n.length;++f){var h=n[f],a=u.indexOf(h);a<0?c.push(h):(o[f]=a,u[a]=i)}var l=t.__nerve__.properties,v=[];for(f=0;f<u.length;++f)u[f]!==i&&v.push(l[f]);var b=l.slice();r.bulkEdit((function(){var r=t.__nerve__.addItems(c,!1);v.length&&(v.sort((function(t,n){return t.Index-n.Index})),D(t,v,!1)),Object(e.a)(n.length===l.length,"All items should be updated into properties.");for(var i=0,u=0;u<n.length;++u)null==o[u]?l[u]=r[i++]:l[u]=b[o[u]];E(t,t.__nerve__.propertyComparer)}))}function R(t,n){t.__nerve__.master.bulkEdit((function(){for(var r=t.length,i=Math.min(r,n.length),e=t.__nerve__.properties,u=0;u<i;++u)e[u].setter(n[u]);if(r<n.length)t.__nerve__.addItems(n.slice(t.length),!1);else if(r>n.length){var c=t.__nerve__.properties.slice(n.length);D(t,c,!1)}}))}function K(t,n){var r=t.__nerve__.master;r.bulkEdit((function(){var i,e=r.Schema[0].__nerve__,u=t.__nerve__.keyToProperty,c={},o=[];n.map(e.getKeyFromSourceData).forEach((function(t,r){c[t]=r,t in u?u[t].getDirtyChecker().onSourceDataReceived(n[r]):o.push(n[r])})),i=e.withDataSource?function(t){return t.Master.Synchronizer.existingInDataSourcePromiseState()===s.d.Resolved&&!(t.getKey()in c)}:function(t){return!(t.getKey()in c)};var f=t.__nerve__.properties.filter(i);D(t,f,!0);var h=ct(o,r.Schema);t.__nerve__.addItems(h,!0);var a=t.__nerve__.propertyComparer;a||(a=function(t,n){return c[t.getKey()]-c[n.getKey()]}),E(t,a)}))}function x(t,n){var r=t.__nerve__.master;r.bulkEdit((function(){for(var i=t.length,e=Math.min(i,n.length),u=t.__nerve__.properties,c=0;c<e;++c)u[c].getDirtyChecker().onSourceDataReceived(n[c]);if(i<n.length){var o=ct(n.slice(i),r.Schema);t.__nerve__.addItems(o,!0)}else if(i>n.length){var s=t.__nerve__.properties.slice(n.length);D(t,s,!0)}}))}var G=function(t){function n(n){var r;n=n||{};var i=r=t.call(this,n)||this,e=r.__nerve__;e.markChildrenAsDeleted=function(){var t;y((t=i).Schema[0])||Object(s.k)(t.Model).map(f).forEach((function(t){return t.Deleted=!0}))},Object(s.q)(e,"markChildrenAsDeleted");var u=r.Schema.__nerve__,c=!u.withDataSource&&!u.info.Attributes.IsLocalField;return e.dirtyChecker=new F(i,n.ExistingInDataSource,c),Object(s.q)(e,"dirtyChecker"),e.model=new P(i,n),Object(s.q)(e,"model"),e.changeManager=new S(i),Object(s.q)(e,"changeManager"),r}Object(i.__extends)(n,t);var r=n.prototype;return r.addItems=function(t){return this.Model.__nerve__.addItems(t,!1).map((function(t){return t.getter()}))},r.deleteItems=function(t){return this.Model.__nerve__.deleteItems(t,!1).map((function(t){return t.getter()}))},r.itemsAddedInSource=function(t){return this.Model.__nerve__.addItems(t,!0).map((function(t){return t.getter()}))},r.itemsDeletedInSource=function(t){return this.Model.__nerve__.deleteItems(t,!0).map((function(t){return t.getter()}))},r.getItemWithKeyFields=function(t){var n=this.Schema[0].__nerve__.getKey(t),r=this.Model.__nerve__.keyToProperty[n];return r&&r.getter()},r.getIndexWithKeyFields=function(t){var n=this.Schema[0].__nerve__.getKey(t),r=this.Model.__nerve__.keyToProperty[n];return r?r.Index:-1},r.markAsChanged=function(t){var n=this.Model.__nerve__.properties[t];n&&this.__nerve__.changeManager.definitelyMarkAsChanged(n)},r.setComparer=function(t){this.Model.__nerve__.setComparer(t)},r.setData=function(t){this.Model.__nerve__.setData(Object(s.k)(t))},n}(a);var U=function(t){function n(n,r,i){var e=t.call(this,n,r,i)||this,u=r.__nerve__.subMasterClassGetter();return e.R=new u(i),e}Object(i.__extends)(n,t);var r=n.prototype;return Object.defineProperty(r,"Master",{get:function(){return this.R},enumerable:!1,configurable:!0}),r.getter=function(){return this.R.Model},r.setter=function(t){this.R.setData(t,this.R.Schema.__nerve__.subFields.toArray())},r.markAsDeleted=function(n){t.prototype.markAsDeleted.call(this,n),n&&(this.getDirtyChecker().ExistingInSource=!1),this.R.Deleted=!0},r.getDirtyChecker=function(){return this.R.__nerve__.dirtyChecker},r.indexDirtinessUpdateNeeded=function(){return!this.FieldSchema.__nerve__.withDataSource},n}(j);function L(t){return t.__nerve__.info.IsCollection}function Q(t,n,r,i,u,c){var o=r.Schema,f=o.__nerve__,h=ht({enumTypeGetter:f.enumTypeGetter,getKeyForReferenceType:f.getKeyForReferenceType,info:{Attributes:c,FieldId:t,IsCollection:f.info.IsCollection,IsLeaf:f.info.IsLeaf,Name:i,Path:u||i},parentMasterClass:n,parentSchema:n.__nerve__.schema,shadowParent:o,shadowRoot:o,subMasterClassGetter:function(){return r},withDataSource:f.withDataSource}),a={};return a[rt(r.__nerve__.schema)]=h,h.__nerve__.generateProperty=function(t){return function(n,r){return new U(n,t,r)}}(h),Object(s.q)(h.__nerve__,"generateProperty"),h.__nerve__.shadowMapper=function(t,n){return function r(i){var u=rt(i),c=n[u];if(!c){var o=i.__nerve__.parentSchema;c=($(o)?r(o):t)[it(i)],Object(e.a)(c===n[u],"the new shadow should be added into the shadow map.")}return c}}(h,a),Object(s.q)(h.__nerve__,"shadowMapper"),z(h,r.Schema,a),h}function z(t,n,r){Object.keys(n).forEach((function(i){Object(s.m)(t,i,function(t,n,r,i){return function(){var e=n[r],u=e.__nerve__,c=ht({enumTypeGetter:u.enumTypeGetter,getKeyForReferenceType:u.getKeyForReferenceType,info:{Attributes:u.info.Attributes,FieldId:lt(),IsCollection:u.info.IsCollection,IsLeaf:u.info.IsLeaf,Name:r,Path:at(t.__nerve__.info.Path,r)},parentSchema:t,parentMasterClass:t.__nerve__.parentMasterClass,shadowParent:e,shadowRoot:u.shadowRoot,subMasterClassGetter:u.subMasterClassGetter,withDataSource:u.withDataSource});return i[rt(e)]=c,z(c,e,i),c}}(t,n,i,r))}))}var V={ObjectSynchronizer:void 0},_=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}Object(i.__extends)(n,t);var r=n.prototype;return r.getSnapshot=function(n){var r=t.prototype.getSnapshot.call(this,n);if(!n)return r;var i={};return this.Master.Schema.__nerve__.subFields.intersection(n).toArray().map(it).forEach((function(t){return i[t]=r[t]})),i},r.initializeSnapshot=function(){var t=this;this.yt={};var n=this.Master,r=n.Schema.__nerve__.subFields.toArray();if(W(n)){var i=n;r=r.filter((function(t){return i.isFieldReady(t)}))}r.forEach((function(n){return t.At(n)}))},r.refreshSubSnapshot=function(t){this.At(t.FieldSchema)},r.createSnapshotCache=function(){return Object.freeze(Object(s.j)(this.yt))},r.createChange=function(n){var r=t.prototype.createChange.call(this,n);return r.UpdateNeeded||(r.UpdateNeeded=n.toArray().some((function(t){return t.__nerve__.info.IsLeaf&&!t.__nerve__.info.Attributes.IsLocalField}))),r.UpdateNeeded||(r.UpdateNeeded=r.SubChanges.filter((function(t){return t.UpdateNeeded})).some((function(t){var r=t.Master.Membership.FieldSchema;return n.has(r)&&!r.__nerve__.info.Attributes.IsLocalField}))),r},r.removeUnchangedFields=function(t,n){var r=this,i=this.Master.Schema,e=t.toArray().filter((function(t){if(t.__nerve__.parentSchema===i&&y(t)){var e=it(t);return r.Master.Model[e]===n[e]}return!1}));t.removeFieldSchemas(e)},r.At=function(t){var n=it(t),r=this.Master.Model[n];if(y(t))this.yt[n]=r;else{var i=f(r);this.yt[n]=i.getSnapshot()}},n}(v),B=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}Object(i.__extends)(n,t);var r=n.prototype;return r.initializeSourceData=function(t){t=this.Rt(t);var n=this.Master.Schema,r=this.Master.Model.__nerve__.properties;for(var i in r){var e=n[i].__nerve__.sourceName;r[i].getDirtyChecker().initializeSourceData(t[e])}},r.getDelta=function(){var t=this;if(this.isDirty()){var n=this.Master.Schema,r={};return this.getDirtyKeys().sort().forEach((function(i){var e=n[i].__nerve__.sourceName;r[e]=t.Kt(i).getSnapshotToUpdate()})),r}},r.getSnapshotToUpdate=function(){var t={},n=this.Master.Schema,r=this.xt();for(var i in r){t[n[i].__nerve__.sourceName]=r[i].getSnapshotToUpdate()}return t},r.getSourceData=function(){var t={},n=this.Master.Schema,r=this.xt();for(var i in r){t[n[i].__nerve__.sourceName]=r[i].getSourceData()}return t},r.setSourceData=function(t){var n=this;t=this.Rt(t),Object.keys(t).forEach((function(r){n.Gt(r).setSourceData(t[r])}))},r.onSourceDataReceived=function(t){var n,r=this;t=this.Rt(t);var i=this.Master;if(W(i)){n=new s.c;var e=this.Master.Schema.__nerve__.sourceNameToClientName,u=Object.keys(t).map((function(t){return e[t]})).filter((function(t){return t}));i.Synchronizer.markFieldsAsReady(u,n.promise())}i.bulkEdit((function(){Object.keys(t).forEach((function(n){r.Gt(n).onSourceDataReceived(t[n])}))})),n&&n.resolve()},r.Rt=function(t){var n=this.Master.Schema.__nerve__.sourceNameToClientName,r={};return t?Object.keys(t).filter((function(t){return t in n})).forEach((function(n){return r[n]=t[n]})):Object.keys(n).forEach((function(t){return r[t]=null})),r},r.xt=function(){var t=this.Master.Model.__nerve__.properties,n={};return this.Master.Schema.__nerve__.subFields.toArray().filter((function(t){return!t.__nerve__.info.Attributes.IsLocalField})).map(it).forEach((function(r){return n[r]=t[r].getDirtyChecker()})),n},r.Kt=function(t){return this.Master.Model.__nerve__.properties[t].getDirtyChecker()},r.Gt=function(t){var n=this.Master.Schema.__nerve__.sourceNameToClientName[t];return this.Kt(n)},n}(I),J=function(t){function n(n,r,i,u,c,o){var f,h={};f=t.call(this,{master:n,properties:h})||this;var a=function(t){return W(t)?function(n,r){var i=function(){if(!t.isFieldReady(r)){var n=et(r);Object(e.b)("The field ("+n+") not ready yet.")}};return{getter:function(){return i(),n.getter()},setter:function(t){i(),n.setter(t)}}}:function(t,n){return{getter:function(){return t.getter()},setter:function(n){return t.setter(n)}}}}(n);return Object.keys(n.Schema).forEach((function(t){var e=n.Schema[t],l=e.__nerve__.generateProperty(t,{InitialData:r[t],ExistingInDataSource:i,MasterTreeReady:c,Reserved:{Membership:{FieldSchema:e,Parent:n},ParentExistingInDataSource:o,Mounted:u}});h[t]=l;var v=a(l,e);Object(s.n)(f,t,v.getter,v.setter)})),f}return Object(i.__extends)(n,t),n}(o);function W(t){return t instanceof X}function q(t,n,r){Object(w.d)(t,n);var e=function(t){function n(n,i){return t.call(this,n,i,r)||this}Object(i.__extends)(n,t);var e=n.prototype;return Object.defineProperty(n,"Schema",{get:function(){return n.__nerve__.schema},enumerable:!1,configurable:!0}),Object.defineProperty(e,"Schema",{get:function(){return n.__nerve__.schema},enumerable:!1,configurable:!0}),n}(r?X:H);return Object(c.b)(e,Object(s.i)({nerveObjectType:"object master",masterName:t,dataSourceFactory:r}),!0),e.__nerve__.schema=ft(e,n),Object(s.q)(e.__nerve__,"schema"),e}var H=function(t){function n(n,r,i){var e;n=n||{},r=r||{};var u=(e=t.call(this,n)||this).__nerve__;u.markChildrenAsDeleted=function(){var t;(t=e).Schema.__nerve__.subFields.toArray().filter((function(t){return!y(t)})).map(it).map((function(n){return t.Model.__nerve__.properties[n]})).map((function(t){return t.Master})).forEach((function(t){return t.Deleted=!0}))},Object(s.q)(u,"markChildrenAsDeleted");var c,o=new s.c,f=Object(s.f)(r.MasterReady,o.promise()),h=!i&&u.membership&&!u.membership.FieldSchema.__nerve__.info.Attributes.IsLocalField;if(u.dirtyChecker=new B(e,n.ExistingInDataSource,h),Object(s.q)(u,"dirtyChecker"),i?(u.synchronizer=new V.ObjectSynchronizer(e,n,r,f,i),c=u.synchronizer.existingInDataSource()):(u.synchronizer=null,c=n.Reserved&&n.Reserved.ParentExistingInDataSource),Object(s.q)(u,"synchronizer"),u.model=new J(e,n.InitialData||{},n.ExistingInDataSource,f,Object(s.f)(n.MasterTreeReady,f).then((function(){})),c),Object(s.q)(u,"model"),u.changeManager=new _(e),Object(s.q)(u,"changeManager"),i){var a=ot(n.ExistingInDataSource?n.InitialData:null,e.Schema);u.dirtyChecker.initializeSourceData(a)}return o.resolve(),e}Object(i.__extends)(n,t);var r=n.prototype;return r.setData=function(t,n){var r=this.Model;if(t!==r){var i;if(t=t||{},n)i=Y(this,n);else{var u=this.Schema;i=Object.keys(t).map((function(t){return u[t]})).filter((function(t){return t}))}var c=[];this.bulkEdit((function(){i.map(it).forEach((function(n){n in r?r[n]=t[n]:c.push(n)}))})),c.length&&Object(e.e)("following field(s) not found in "+h(this)+": "+c)}},r.getModelByFieldSchema=function(t){var n=t;tt(n),n=Z(this,n);for(var r=this.Schema,i=[];n!==r;){if(i.push(n),n.__nerve__.info.IsCollection)throw Error("unable to get model/value from collection "+et(n)+".");n=n.__nerve__.parentSchema}var e=this.Model;do{e=e[it(n=i.pop())]}while(i.length);return e},n}(a),X=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}Object(i.__extends)(n,t);var r=n.prototype;return Object.defineProperty(r,"Synchronizer",{get:function(){return this.__nerve__.synchronizer},enumerable:!1,configurable:!0}),r.isFieldReady=function(t){return this.Synchronizer.isFieldReady(t)},r.ensureFieldsReady=function(t){return this.Synchronizer.ensureFieldsReady(t)},r.fieldsReady=function(t){return this.Synchronizer.fieldsReady(t)},r.getRelatedSourceFields=function(t){return t},r.forceFieldsReady=function(t){return this.Synchronizer.forceFieldsReady(t)},n}(H);function Y(t,n){return n.map((function(n){var r=t.Schema;if("string"==typeof n){var i=r[n];if($(i))return i}else if($(n))return Z(t,n);Object(e.b)("field "+n+" doesn't exist in master "+h(t))}))}function Z(t,n){for(var r=t.Schema,i=[];n.__nerve__.shadowRoot!==r;){var u=it(n);i.push(u),(n=n.__nerve__.parentSchema)||Object(e.b)("field schema ("+et(n)+") is not a member schema of master ("+h(t)+")")}for(var c=r;i.length;){c=c[u=i.pop()]}return c}function $(t){var n=t&&t.__nerve__;return n&&"FieldSchema"===n.nerveObjectType}function tt(t){if(!$(t))throw Error("Invalid parameter: please use '<your master [class]>.Schema.*' for the parameter.");return!0}function nt(t){return tt(t),t.__nerve__.info}function rt(t){return nt(t).FieldId}function it(t){return nt(t).Name}function et(t){return nt(t).Path}function ut(t){return bt[t]}function ct(t,n){if(y(n)){if(n.__nerve__.asEnum){var r=n.__nerve__.enumType;if(r&&"string"==typeof t&&t in r)return r[t]}return t}if(L(n))return Object(s.k)(t).map((function(t){return ct(t,n[0])}));if(t){var i={},e=n.__nerve__.sourceNameToClientName;return Object.keys(t).forEach((function(r){if(r in e){var u=e[r],c=n[u];i[u]=ct(t[r],c)}})),i}return null}function ot(t,n){if(y(n)){if(n.__nerve__.asEnum){var r=n.__nerve__.enumType;if(r&&"number"==typeof t&&t in r)return r[t]}return t}if(L(n))return Object(s.k)(t).map((function(t){return ot(t,n[0])}));if(t){var i={};return Object.keys(n).forEach((function(r){if(r in t){var e=n[r];if(!e.__nerve__.info.Attributes.IsLocalField){var u=e.__nerve__.sourceName;i[u]=ot(t[r],e)}}})),i}return null}function st(t,n){if(y(n))return t;if(L(n))return Object(s.k)(t).map((function(t){return st(t,n[0])}));if(t){var r={},i=n.__nerve__.sourceNameToClientName;return Object.keys(t).forEach((function(e){if(e in i){var u=n[i[e]];r[e]=st(t[e],u)}})),r}return null}function ft(t,n){var r=t.__nerve__.masterName,e={enumTypeGetter:null,getKeyForReferenceType:null,info:{Attributes:Object(w.b)(n),FieldId:lt(),IsCollection:!(!Object(w.c)(n)||!n.__nerve__.isCollection),IsLeaf:!1,Name:r,Path:r},parentMasterClass:t,shadowParent:null,withDataSource:!!t.__nerve__.dataSourceFactory};e.info.IsCollection&&Object(s.m)(e,"withDataSource",(function(){return u[0].__nerve__.withDataSource}));var u=ht(e);return Object.keys(n).forEach((function(r){Object(s.m)(u,r,function(t,n,r){var e=lt();return function(){var u,o=at(t.__nerve__.masterName,n);if(Object(w.c)(r)){if(r.__nerve__.isLeaf)return p(e,t,r,n,o);r.__nerve__.isCollection?u=function(t,n){var r=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}Object(i.__extends)(n,t);var r=n.prototype;return Object.defineProperty(n,"Schema",{get:function(){return n.__nerve__.schema},enumerable:!1,configurable:!0}),Object.defineProperty(r,"Schema",{get:function(){return n.__nerve__.schema},enumerable:!1,configurable:!0}),n}(G);return Object(c.b)(r,Object(s.i)({nerveObjectType:"collection master",masterName:t}),!0),r.__nerve__.schema=ft(r,n),Object(s.q)(r.__nerve__,"schema"),r}(o,r):r.__nerve__.masterClassGetter&&(u=r.__nerve__.masterClassGetter())}u||(u=q(o,r));var f=Object(w.b)(r);return Q(e,t,u,n,o,f)}}(t,r,n[r]))})),u}function ht(t){var n={};return t.info=Object(s.i)(t.info),t.nerveObjectType="FieldSchema",t.shadowParent=t.shadowParent||null,t.shadowRoot=t.shadowRoot||n,Object(s.m)(t,"sourceFieldSet",(function(){var n=t.subFields.toArray().filter((function(t){return!t.__nerve__.info.Attributes.IsLocalField}));return new u(n)})),Object(s.m)(t,"sourceName",(function(){return t.info.Attributes.SourceFieldName||t.info.Name})),Object(s.m)(t,"sourceNameToClientName",(function(){var n={};return t.sourceFieldSet.toArray().forEach((function(t){n[t.__nerve__.sourceName]=t.__nerve__.info.Name})),Object.freeze(n)})),Object(s.m)(t,"subFields",(function(){var t=new u;return Object.keys(n).forEach((function(r){t.addFieldSchema(n[r])})),t})),Object(s.m)(t,"allContainedFields",(function(){var t=new u([n]);return Object.keys(n).forEach((function(r){var i=n[r];t.addFieldSchemas(i.__nerve__.allContainedFields)})),t})),Object(s.m)(t,"asEnum",(function(){return!!t.enumType&&!t.info.Attributes.IsNumberTypeInDataSource})),Object(s.m)(t,"enumType",(function(){return t.enumTypeGetter&&t.enumTypeGetter()})),t.info.IsLeaf?Object(s.m)(t,"getKey",(function(){return Object(e.a)(t.getKeyForReferenceType,"getKey has been called but no keyGetter specified for "+t.info.Path),t.getKeyForReferenceType})):Object(s.m)(t,"getKey",(function(){var n=t.keyFields.toArray().map(it).sort();return Object(e.a)(n.length>0,"getKey has been called but there's no key fields of "+t.info.Path),function(t){var r=n;if(t instanceof J){var i=t.__nerve__.master;if(W(i)){var e=i;if(!(r=n.filter((function(t){return e.isFieldReady(t)}))).length)return}}var u={};return r.forEach((function(n){return u[n]=t[n]})),JSON.stringify(u)}})),Object(s.m)(t,"getKeyFromSourceData",(function(){var n=t.keyFields.toArray(),r=t.sourceNameToClientName,i=n.map((function(t){return t.__nerve__.sourceName}));return function(n){var e={};return i.forEach((function(t){var i=r[t];e[i]=n[t]})),t.getKey(e)}})),Object(s.m)(t,"keyFields",(function(){return new u(t.subFields.toArray().filter((function(t){return t.__nerve__.info.Attributes.IsKeyField})))})),t.info.IsLeaf?Object(s.m)(t,"withKey",(function(){return!!t.getKeyForReferenceType})):Object(s.m)(t,"withKey",(function(){return t.keyFields.Count>0})),Object(c.b)(n,t),Object(s.l)(n,"toJSON",(function(){return"[Nerve] FieldSchema: ("+t.info.Path+")>"}),!1),t.info.IsCollection&&Object(s.l)(n,"length",1,!1),bt[t.info.FieldId]=n,n}function at(t,n){return t+"/"+n}function lt(){return(vt++).toString()}var vt=1,bt={},dt=function(t){function n(){var n=t.call(this,{InitialData:{InProcess:!1,AllSucceeded:!0,Scheduled:!1,CreationError:null,CreationFailed:!1,CreationInProcess:!1,CreationRetryScheduled:!1,CreationScheduled:!1,QueryError:null,QueryFailed:!1,QueryInProcess:!1,UpdateError:null,UpdateFailed:!1,UpdateInProcess:!1,UpdateRetryScheduled:!1,UpdateScheduled:!1}})||this;return n.addRule(Ot),n.addRule(jt),n.addRule(mt),n}return Object(i.__extends)(n,t),n}(q("Nerve.ObjectSynchronizerMaster",{InProcess:w.a.boolean(),AllSucceeded:w.a.boolean(),Scheduled:w.a.boolean(),CreationError:w.a.reference(),CreationFailed:w.a.boolean(),CreationInProcess:w.a.boolean(),CreationScheduled:w.a.boolean(),CreationRetryScheduled:w.a.boolean(),QueryError:w.a.reference(),QueryFailed:w.a.boolean(),QueryInProcess:w.a.boolean(),UpdateError:w.a.reference(),UpdateFailed:w.a.boolean(),UpdateInProcess:w.a.boolean(),UpdateRetryScheduled:w.a.boolean(),UpdateScheduled:w.a.boolean()})),Ot={Name:"InProcess",InterestedFields:[dt.Schema.CreationInProcess,dt.Schema.QueryInProcess,dt.Schema.UpdateInProcess],onChange:function(t){var n=t.Master.Model;n.InProcess=n.CreationInProcess||n.QueryInProcess||n.UpdateInProcess}},jt={Name:"AllSucceeded",InterestedFields:[dt.Schema.CreationFailed,dt.Schema.QueryFailed,dt.Schema.UpdateFailed],onChange:function(t){var n=t.Master.Model;n.AllSucceeded=!(n.CreationFailed||n.QueryFailed||n.UpdateFailed)}},mt={Name:"Scheduled",InterestedFields:[dt.Schema.CreationScheduled,dt.Schema.CreationRetryScheduled,dt.Schema.UpdateScheduled,dt.Schema.UpdateRetryScheduled],onChange:function(t){var n=t.Master.Model;n.Scheduled=n.CreationScheduled||n.CreationRetryScheduled||n.UpdateScheduled||n.UpdateRetryScheduled}},gt=function(){function t(t){t?(this.Ut=new wt({retry:t.retryForCreation&&t.retryForCreation.bind(t),cancel:t.cancelRetryForCreation&&t.cancelRetryForCreation.bind(t)}),this.Lt=new wt({retry:t.retryForUpdate&&t.retryForUpdate.bind(t),cancel:t.cancelRetryForUpdate&&t.cancelRetryForUpdate.bind(t)})):(this.Ut=new wt,this.Lt=new wt),this.Qt=t||{}}var n=t.prototype;return n.scheduleUpdate=function(){return this.zt?(this.Qt.postponeUpdate&&this.Qt.postponeUpdate(),this.zt.promise()):this.Vt()},n.postponeUpdate=function(){this.Qt.postponeUpdate&&this.Qt.postponeUpdate()},n.flush=function(){this.Ut.flush(),this.Lt.flush(),this._t&&(this._t.cancel(),this._t=void 0,this.Qt.cancelUpdate&&this.Qt.cancelUpdate()),this.zt&&(this.zt.resolve(),this.zt=void 0)},n.cancelUpdate=function(){this.zt&&(this.zt.reject(),this.Qt.cancelUpdate&&this.Qt.cancelUpdate())},n.retryForCreation=function(t){return this.Ut.retry(t)},n.cancelRetryForCreation=function(){return this.Ut.cancel()},n.retryForUpdate=function(t){return this.Lt.retry(t)},n.cancelRetryForUpdate=function(){return this.Lt.cancel()},n.Vt=function(){var t=this;this.zt||(this.zt=new s.c);var n,r=this.zt;return n=this.Qt.scheduleUpdate?this.Qt.scheduleUpdate():Promise.resolve(),this._t=new s.b(n),this._t.promise().finally((function(){t.zt=void 0,t._t=void 0})).then((function(){r.resolve()}),(function(){r.reject(new Error("this.cancelableUpdateSchedule rejected."))})),r.promise()},t}(),wt=function(){function t(t){this.Qt=t||{}}var n=t.prototype;return n.retry=function(t){var n=this;return this.Qt.retry?(this.cancel(),this.Bt=new s.b(this.Qt.retry(t)),this.Jt=new Promise((function(t,r){n.Wt=t,n.qt=r})),this.Bt.promise().finally((function(){n.Jt=void 0,n.Bt=void 0})).then(this.Wt,this.qt),this.Jt):Promise.reject("Scheduler has no retry.")},n.flush=function(){this.Bt&&(this.Bt.cancel(),this.Bt=void 0,this.Qt.cancel&&this.Qt.cancel()),this.Jt&&(this.Jt=void 0,this.Wt())},n.cancel=function(){this.Bt&&(this.Bt.cancel(),this.Jt=void 0,this.Bt=void 0,this.Qt.cancel&&this.Qt.cancel())},t}(),yt=function(t){function n(n,r,i,e,u){var c=t.call(this)||this;c.Ht=new s.c,c.Xt=new s.c,c.Yt={},c.Zt={},c.$t={},c.tn=Promise.resolve(),c.nn=0,c.rn=[],c.R=n,c.Qt=new gt(i.Scheduler),c.in();var o=r.Reserved&&r.Reserved.ParentExistingInDataSource;c.en=Object(s.f)(r.MasterTreeReady,e,o).then((function(){return u(n,(function(t){return c.onSourceDataReceived(t)}),i.DataSourceContext)}));var f=c.un(r);if(f.length){var h=Object(s.p)();f.forEach((function(t){c.Yt[t]=!0,c.Zt[t]=h}))}return e.then((function(){n.observe((function(t){t.UpdateNeeded&&c.cn()}))})),!r.ExistingInDataSource?c.on():(c.sn=new s.e(e),e.then((function(){return c.cn()}))),c}Object(i.__extends)(n,t);var r=n.prototype;return r.flush=function(){var t=this;return this.Qt.flush(),this.sn.promise().then((function(){return t.Xt.promise()}))},r.existingInDataSource=function(){return this.sn.promise()},r.existingInDataSourcePromiseState=function(){return this.sn.states()},r.deletedFromDataSource=function(){var t=this;return this.sn.promise().then((function(){return t.Ht.promise()}),(function(){return Promise.resolve()}))},r.isFieldReady=function(t){t=this.R.getRelatedSourceFields([t])[0];var n=it(Y(this.R,[t])[0]);return!!this.Yt[n]},r.ensureFieldsReady=function(t){var n=this;t=this.R.getRelatedSourceFields(t);var r=Y(this.R,t);return r.filter((function(t){return!n.isFieldReady(t)})).length?this.sn.promise().then((function(){var t=r.filter((function(t){return!n.isFieldReady(t)}));if(t.length)return n.query(t)})).then((function(){return n.fn()})):Promise.resolve()},r.forceFieldsReady=function(t){var n=this;t=this.R.getRelatedSourceFields(t),Y(this.R,t).filter((function(t){return!n.isFieldReady(t)})).forEach((function(t){n.Yt[it(t)]=!0}))},r.fieldsReady=function(t){var n=this;t=this.R.getRelatedSourceFields(t);var r=Y(this.R,t).map(it).map((function(t){return n.Zt[t]||(n.Zt[t]=new s.c),n.Zt[t].promise()}));return Promise.all(r).then((function(){return n.fn()}))},r.query=function(t){var n=this;t=this.R.getRelatedSourceFields(t);var r=Y(this.R,t);return this.sn.promise().then((function(){var t=[],i=new s.c,e=new s.e(i.promise().then((function(){return n.hn(t)}))),u=[];return r.filter((function(t){return!t.__nerve__.info.Attributes.IsLocalField})).forEach((function(r){var i=it(r),c=n.$t[i];c&&c.states()===s.d.Pending||(n.$t[i]=e,t.push(r.__nerve__.sourceName)),u.push(n.$t[i].promise())})),t.length?i.resolve():i.reject(new Error("FieldNamesToQuery is empty.")),Promise.all(u)})).then((function(){return n.fn()}))},r.onSourceDataReceived=function(t){var n=this,r=st(t,this.R.Schema);return this.rn.push(r),this.tn.then((function(){return n.an()}))},r.onDeletedInDataSource=function(){this.ln().ExistingInSource=!1,this.R.Deleted=!0},r.setFieldsQueryJob=function(t,n){var r=this,i=Y(this.R,this.R.getRelatedSourceFields(t)).filter((function(t){return!t.__nerve__.info.Attributes.IsLocalField})),e=new s.c,u=e.promise().then((function(){return n})).then((function(t){var n={};return i.map((function(t){return t.__nerve__.sourceName})).forEach((function(r){return n[r]=t[r]})),r.onSourceDataReceived(n)}));i.map(it).forEach((function(t){var n=r.$t[t];n&&n.states()===s.d.Pending?r.$t[t]=new s.e(Object(s.h)(n.promise(),u)):r.$t[t]=new s.e(u)})),e.resolve()},r.markFieldsAsReady=function(t,n){var r=this;t.forEach((function(t){return r.Yt[t]=!0})),n.then((function(){var n=Object(s.p)();t.forEach((function(t){r.Zt[t]?r.Zt[t].resolve():r.Zt[t]=n}))}))},r.in=function(){var t=this;this.Xt=Object(s.p)(),this.observe((function(){return t.vn()}),[this.Schema.UpdateError,this.Schema.UpdateFailed,this.Schema.UpdateInProcess,this.Schema.UpdateScheduled])},r.vn=function(){var t=this.Model;t.UpdateScheduled||t.UpdateInProcess?this.Xt.states()!==s.d.Pending&&(this.Xt=new s.c):t.UpdateFailed?t.UpdateRetryScheduled||this.Xt.reject(t.UpdateError):this.Xt.resolve()},r.un=function(t){var n=this.R.Schema.__nerve__.subFields;if(t.ExistingInDataSource){var r=t.InitialData||{},i=[];return n.toArray().forEach((function(t){var n=it(t);(t.__nerve__.info.Attributes.IsLocalField||n in r)&&i.push(n)})),i}return n.toArray().filter((function(t){return!t.__nerve__.info.Attributes.IsSourceGenerated})).map(it)},r.cn=function(){var t=this;this.ln().isDirty()?(this.bulkEdit((function(){t.Model.UpdateScheduled=!0})),Object(s.f)(this.sn.promise(),this.Qt.scheduleUpdate()).then((function(){t.nn=0,t.bn()}),(function(){}))):(this.Qt.cancelUpdate(),this.Model.UpdateScheduled=!1)},r.bn=function(){if(this.dn)this.On=!0;else if(this.ln().isDirty()){if(this.jn(),this.ln().isDirty())return this.R.__nerve__.deleted?this.mn():this.gn();Object(e.e)("onUpdateStart changes dirtiness."),this.wn()}else this.wn()},r.ln=function(){return this.R.__nerve__.dirtyChecker},r.on=function(){var t=this,n=this.R,r=new Promise((function(r,i){t.bulkEdit((function(){t.Model.CreationScheduled=!0,t.en.then((function(e){var u=function(){if(t.Qt.cancelRetryForCreation(),n.__nerve__.deleted)return t.bulkEdit((function(){t.Model.CreationFailed=!1,t.Model.CreationInProcess=!1,t.Model.CreationRetryScheduled=!1,t.Model.CreationScheduled=!1}));t.bulkEdit((function(){t.Model.CreationError=null,t.Model.CreationFailed=!1,t.Model.CreationInProcess=!0,t.Model.CreationRetryScheduled=!1,t.Model.CreationScheduled=!1}));var o=t.ln(),s=o.getDelta()||{},f=o.getSnapshotToUpdate(),h=t.tn.then((function(){return e.add(s,{Master:n,Snapshot:f})})).then((function(i){n.bulkEdit((function(){o.ExistingInSource=!0,o.setSourceData(s),i&&t.yn(i)})),t.bulkEdit((function(){t.Model.CreationInProcess=!1,t.cn()})),r()})).catch((function(n){t.bulkEdit((function(){t.Model.CreationFailed=!0,t.Model.CreationError=n,t.Model.CreationInProcess=!1,t.Model.CreationRetryScheduled=!0,t.Qt.retryForCreation(++c).then(u).catch((function(){t.Model.CreationRetryScheduled=!1,i(n)}))}))}));t.pn(h)},c=0;u()}))}))}));this.sn=new s.e(r)},r.mn=function(){var t=this,n=this.ln(),r=this.tn.then((function(){return t.en})).then((function(r){var i=n.getSnapshotToUpdate();return r.delete(i,{Master:t.R,Snapshot:i})})).then((function(){return n.ExistingInSource=!1}));return this.pn(r),r.then((function(n){return t.wn(!1),t.Ht.resolve(),n})).catch((function(n){throw t.Sn(n,!1,(function(){t.Ht.reject(n)})),n}))},r.hn=function(t){var n=this,r=this.tn.then((function(){return n.en})).then((function(r){return n.bulkEdit((function(){n.Model.QueryError=null,n.Model.QueryInProcess=!0})),r.query(t,{Master:n.R,Snapshot:null})})).then((function(r){if(r){var i={};Object.keys(r).concat(t).forEach((function(t){return i[t]=r[t]})),n.yn(i)}}));return this.pn(r),r.then((function(){n.Model.QueryInProcess=!1})).catch((function(t){throw n.bulkEdit((function(){n.Model.QueryError=t,n.Model.QueryInProcess=!1})),t}))},r.gn=function(){var t=this,n=this.ln(),r=n.getDelta(),i=n.getSnapshotToUpdate(),u=n.getSourceData();null==r&&Object(e.e)("data is null when it's dirty.");var c=this.tn.then((function(){return t.en})).then((function(n){return n.update(r,{Master:t.R,Snapshot:i,ValuesBefore:u})})).then((function(i){t.R.bulkEdit((function(){n.setSourceData(r),i&&t.yn(i)}))}));return this.pn(c),c.then((function(){return t.wn(!0)})).catch((function(n){throw t.Sn(n,!0),n}))},r.jn=function(){var t=this;this.dn=!0,this.On=!1,this.Qt.cancelRetryForUpdate(),this.bulkEdit((function(){t.Model.UpdateError=null,t.Model.UpdateFailed=!1,t.Model.UpdateInProcess=!0,t.Model.UpdateRetryScheduled=!1,t.Model.UpdateScheduled=!1}))},r.wn=function(t){var n=this;this.dn=!1,this.nn=0,this.Qt.cancelRetryForUpdate(),this.bulkEdit((function(){n.Model.UpdateError=null,n.Model.UpdateFailed=!1,n.Model.UpdateInProcess=!1,n.Model.UpdateRetryScheduled=!1,n.Model.UpdateScheduled=!1,t&&(n.On?n.bn():n.cn())}))},r.Sn=function(t,n,r){var i=this;this.ln().isDirty()?(this.dn=!1,this.bulkEdit((function(){i.Model.UpdateError=t,i.Model.UpdateFailed=!0,i.Model.UpdateInProcess=!1,i.Model.UpdateRetryScheduled=!0,i.Model.UpdateScheduled=!0,n&&i.On?i.bn():i.Qt.retryForUpdate(++i.nn).then((function(){return i.bn()})).catch((function(){i.bulkEdit((function(){i.Model.UpdateRetryScheduled=!1,i.Model.UpdateScheduled=!1})),r&&r()}))}))):this.wn()},r.yn=function(t){var n=st(t,this.R.Schema);this.ln().onSourceDataReceived(n)},r.pn=function(t){var n=this;this.tn=Object(s.g)(t).then((function(){return n.an()}))},r.an=function(){var t=this.ln(),n=this.rn;this.rn=[],this.R.bulkEdit((function(){n.forEach((function(n){return t.onSourceDataReceived(n)}))}))},r.fn=function(){return this.R.__nerve__.changeManager.getChangingPeriod()},n}(dt);V.ObjectSynchronizer=yt;var pt=function(){function t(){}t.prototype;return t.getSubFieldSchemas=function(t){return function(t){return tt(t),t.__nerve__.subFields.toArray()}(t)},t.convertFromSourceData=function(t,n){return ct(t,n)},t.convertToSourceData=function(t,n){return ot(t,n)},t.convertToArray=function(t){return Object(s.k)(t)},t.getFieldSchemaInfo=function(t){return nt(t)},t.getObjectMasterFromModel=function(t){return f(t)},t.getCollectionMasterFromModel=function(t){return f(t)},t.createObjectMasterClass=function(t,n,r){return q(t,n,r)},t.isObjectMasterClass=function(t){return function(t){var n=t;return!!n.__nerve__&&"object master"===n.__nerve__.nerveObjectType}(t)},t}();Object(s.q)(pt,"convertToArray"),Object(s.q)(pt,"getFieldSchemaInfo"),Object(s.q)(pt,"getSubFieldSchemas"),Object(s.q)(pt,"convertFromSourceData"),Object(s.q)(pt,"convertToSourceData"),Object(s.q)(pt,"createObjectMasterClass"),Object(s.q)(pt,"getObjectMasterFromModel"),Object(s.q)(pt,"getCollectionMasterFromModel"),Object(s.q)(pt,"isObjectMasterClass");var St={addItems:null,deleteItems:null,getIndexWithKeyFields:null,getItemWithKeyFields:null,itemsAddedInSource:null,itemsDeletedInSource:null,markAsChanged:null,setComparer:null};for(var It in St)St[It]=Ft(It);function Ft(t){return function(n){for(var r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];var e=pt.getCollectionMasterFromModel(n),u=e[t];return u.apply(e,r)}}pt.Collection=Object.freeze(St),Object(s.q)(pt,"Collection")}}]);