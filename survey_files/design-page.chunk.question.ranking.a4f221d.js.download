(window.webpackJsonp=window.webpackJsonp||[]).push([[117],{1117:function(e,t,r){"use strict";r.r(t),r.d(t,"RankingRenderer",(function(){return g}));var i=r(2),o=r(0),s=r(3),n=r(6),a=r(10),c=r(68),l=r(9),h=r(12),u=r(131),f=r(107),d=r(5),p=r(44),m=r(18),b=r(34),g=function(e){function t(t){var r=e.call(this,t)||this;return r.selectedClass="office-form-theme-sort-item office-form-selected-item",r.focusStatus=-1,r.selectedIndex=-1,r.rankingRef=o.createRef(),r.isDragging=!1,r.sortableInitialized=!1,r.mounted=!1,r.updateChoicesInternally(),r.rankUp=r.rankUp.bind(r),r.rankDown=r.rankDown.bind(r),r.focusOnSortItem=r.focusOnSortItem.bind(r),r.blurOnSortItem=r.blurOnSortItem.bind(r),r.onKeyDown=r.onKeyDown.bind(r),r.decorateSortableGroup=r.decorateSortableGroup.bind(r),r.onDragStart=r.onDragStart.bind(r),r.onDragEnd=r.onDragEnd.bind(r),r}Object(i.__extends)(t,e);var r=t.prototype;return r.componentWillMount=function(){var t=this;e.prototype.componentWillMount.call(this),this.mounted=!0,Object(c.a)("Sortable").then((function(){t.mounted&&t.setState({SortableLoaded:!0})})),this.choicesUpdate=function(){t.updateChoicesInternally(),t.forceUpdate()},this.props.Master.Question.observe(this.choicesUpdate,[Object(h.i)().Schema.ChoiceGroup]),this.questionLocalizedItemMaster&&this.questionLocalizedItemMaster.observe(this.choicesUpdate,[f.a.Schema.choices])},r.componentWillUnmount=function(){this.mounted=!1,this.sortable&&(this.sortable.destroy(),this.sortable=void 0),e.prototype.componentWillUnmount.call(this),this.props.Master.Question.unobserve(this.choicesUpdate),this.questionLocalizedItemMaster&&this.questionLocalizedItemMaster.unobserve(this.choicesUpdate)},r.componentWillReceiveProps=function(t){e.prototype.componentWillReceiveProps.call(this,t),t.ShowQuizResult&&this.updateChoicesInternally(),(t.ShowDesignInfo||t.Disabled)&&this.sortable&&(this.sortable.destroy(),this.sortable=void 0)},r.componentDidMount=function(){e.prototype.componentDidMount.call(this);var t=this.rankingRef.current;!this.props.ShowDesignInfo&&!this.props.Disabled&&this.state.SortableLoaded&&t&&this.decorateSortableGroup(t)},r.componentDidUpdate=function(e,t){if(this.choices&&this.choices.length>0&&-1!==this.focusStatus&&this.updateFocusStatus(),!this.props.ShowDesignInfo&&!this.props.Disabled&&this.state.SortableLoaded&&!this.sortable){var r=this.rankingRef.current;r&&this.decorateSortableGroup(r)}},r.createReactNodes=function(){var e=this.createSortableList(),t=this.createCorrectAnswerList(),r=this.props.IsMobile?"office-form-mobile-sort-list":"office-form-sort-list",s=this.getElementProps({className:r,onKeyDown:this.onKeyDown,ref:this.rankingRef,role:"listbox"});return[o.createElement("div",Object(i.__assign)({},s,{key:"Ranking"}),e),t]},r.getFormattedDataForImmersiveReader=function(){var t=e.prototype.getFormattedDataForImmersiveReader.call(this),r=null,i=document.createElement("ul");return s.forEach(this.choices,(function(e){var t=document.createElement("li"),o=null;if(e.IsMathOption&&"undefined"!=typeof MathJax){r=r||MathJax.Hub.getAllJax(null);var n=s.find(r,(function(t){return t.originalText===e.Description}));if(n){var a=n.root&&n.root.toMathML&&n.root.toMathML();a&&(a=a.replace(/\n\s*/g,""),o="\x3c!--[if mathML]&#62;"+Object(l.c)(a,!0)+"&#60;![endif]--\x3e")}}t.innerHTML=o||Object(l.c)(e.Description,!0),i.appendChild(t)})),i.appendChild(document.createElement("br")),t.splice(t.length-1,0,{content:i.outerHTML,mimeType:"text/html"}),t},r.decorateSortableGroup=function(e){var t={animation:150,chosenClass:"office-form-sortable-chosen",delay:this.props.IsMobile?150:0,fallbackClass:"office-form-sortable-fallback",filter:".office-form-ranking-arrow",forceFallback:!0,ghostClass:"office-form-sortable-ghost",handle:".office-form-sort-item",onEnd:this.onDragEnd,onStart:this.onDragStart,preventOnFilter:!1};try{this.sortable=Sortable.create(e,t),this.sortableInitialized||Object(d.b)("DesignPage.Questions.SortableInitialization",{Successful:!0}),this.sortableInitialized=!0}catch(e){Object(d.b)("DesignPage.Questions.SortableInitialization",{Successful:!1}),this.sortableInitialized=!1}},r.onDragStart=function(e){if(this.isDragging=!0,-1!==this.selectedIndex&&this.selectedIndex!==e.oldIndex){var t=this.rankingRef.current;if(t){var r=t.children[this.selectedIndex];r&&$(r.firstElementChild).removeClass(this.selectedClass)}}},r.onDragEnd=function(e){var t=e.oldIndex,r=e.newIndex,i=this.props.Master.Model.Answer;if(this.isDragging=!1,i&&t===r)e.item.firstChild.focus();else{var o=this.rankingRef.current;t<r?$(o).find(".office-form-sort-item-container:eq("+t+")").before($(e.item)):t>r&&$(o).find(".office-form-sort-item-container:eq("+t+")").after($(e.item)),this.focusStatus=0,this.moveElement(t,r)}},r.createSortableList=function(){var e=this,t=this.props.Master.Model.Answer,r=this.shouldShowJudgeIcon(),i=t&&t.length>0;return i&&this.updateChoicesInternally(),s.map(this.choices,(function(t,o){return e.createRankItem(t,o,r,i)}))},r.createRankItem=function(e,r,n,c){var h,u,f=this.questionLocalizedItemMaster;if(f){var d=s.find(f.Model.choices,(function(t){return t.choiceId===e.Id+""}));h=d&&d.description||""}if(h=h||Object(a.i)()&&e.FormsProDisplayRTText||e.Description,c&&n){var g=this.props.Master.Model.QuizResult,v=JSON.parse(g.GradingBasis),I=e.Key===v[r];u=o.createElement("span",{className:"office-form-sort-item-icon"},t.getAnswerKeyMark(I))}!this.props.Disabled&&this.props.IsMobile&&(u=t.createDragHandleIcon());var w,S=o.createElement("div",{className:"office-form-sort-item-indicator"},u,o.createElement("span",{className:"office-form-sort-item-ordinal office-form-theme-secondary-color"},c?r+1:void 0)),M=this.getQuestionId()+"-"+r,y={"aria-posinset":r+1,"aria-setsize":this.choices.length,className:"office-form-sort-item",disabled:this.props.Disabled,id:M,role:"option",tabIndex:this.props.Disabled?void 0:0};if(!this.props.Disabled){var k={disabled:!0,tabIndex:-1},D=0===r,C={"aria-label":this.props.LocalizedStrings.QuestionType_Ranking_ArrowUp_Narrator,className:Object(l.b)("office-form-ranking-arrow",D?"office-sort-disabled-arrow":"office-form-active-arrow"),onClick:D?void 0:this.rankUp,title:this.props.LocalizedStrings.QuestionType_Ranking_ArrowUp_Narrator};C=D?Object(l.g)(C,k):C;var x={ButtonStyle:"LightBackground",children:Object(m.b)({HTMLAttributes:{className:"forms-icon-size18x18"},IconName:"Up"}),HTMLAttributes:C,key:"form-up-arrow"+r},O=o.createElement(p.a,Object(i.__assign)({},x)),L=r===this.choices.length-1,E={"aria-label":this.props.LocalizedStrings.QuestionType_Ranking_ArrowDown_Narrator,className:Object(l.b)("office-form-ranking-arrow",L?"office-sort-disabled-arrow":"office-form-active-arrow"),onClick:L?void 0:this.rankDown,title:this.props.LocalizedStrings.QuestionType_Ranking_ArrowDown_Narrator};E=L?Object(l.g)(E,k):E;var R={ButtonStyle:"LightBackground",children:Object(m.b)({HTMLAttributes:{className:"forms-icon-size18x18"},IconName:"Down"}),HTMLAttributes:E,key:"form-down-arrow"+r},z=o.createElement(p.a,Object(i.__assign)({},R));y=Object(l.g)(y,{onBlur:this.blurOnSortItem,onFocus:this.focusOnSortItem}),w=o.createElement("div",{className:"office-form-sort-list-arrows"},O,z)}var j={Text:h};Object(a.i)()&&(j.RenderMode="RichText",j.ContainsHtml=!0);var A=o.createElement("div",Object(i.__assign)({},y),S,o.createElement("div",{className:"office-form-sort-item-content"},Object(b.b)(j)),w);return o.createElement("div",{className:"office-form-sort-item-container office-form-unselectable",key:e.Key},A)},r.focusOnSortItem=function(e){if(!this.isDragging){var t=e.currentTarget;$(t).addClass(this.selectedClass);var r=this.rankingRef.current;if(r){var i=r.children,o=t.parentElement;this.selectedIndex=s.findIndex(i,(function(e){return o===e}))}}},r.blurOnSortItem=function(e){var t=e.currentTarget,r=Object(l.d)(e);this.isDragging||t&&r&&t.contains(r)||($(t).removeClass(this.selectedClass),this.selectedIndex=-1)},r.rankUp=function(){this.resortItems(0)},r.rankDown=function(){this.resortItems(1)},r.resortItems=function(e){var t,r=this.selectedIndex;0===e?(this.focusStatus=1,t=r-1):(this.focusStatus=2,t=r+1),this.moveElement(r,t)},t.getAnswerKeyMark=function(e){return Object(m.b)({HTMLAttributes:{className:Object(l.b)("office-form-judge-icon forms-icon-size16x16",e?"office-form-right-answerkey":"office-form-wrong-answerkey")},IconName:e?"CheckMark":"Cancel"})},t.stringifyAnswer=function(e){return s.map(e,(function(e,t){return{answerOrder:t,id:e.Id}}))},t.createDragHandleIcon=function(){return o.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"},o.createElement("circle",{cx:"9.5",cy:"6.5",r:"1.5",fill:"currentColor"}),o.createElement("circle",{cx:"14.5",cy:"6.5",r:"1.5",fill:"currentColor"}),o.createElement("circle",{cx:"9.5",cy:"12.5",r:"1.5",fill:"currentColor"}),o.createElement("circle",{cx:"14.5",cy:"12.5",r:"1.5",fill:"currentColor"}),o.createElement("circle",{cx:"9.5",cy:"18.5",r:"1.5",fill:"currentColor"}),o.createElement("circle",{cx:"14.5",cy:"18.5",r:"1.5",fill:"currentColor"}))},r.shouldShowJudgeIcon=function(){var e=this.props.Master.Question.Model,t=this.props.Master.Model.QuizResult;return!(!this.props.ShowQuizResult||!e.IsQuiz)&&!!t},r.createCorrectAnswerList=function(){var e=this.props.Master.Model.QuizResult;if(!this.shouldHideCorrectAnswerList()){var t=this.props.Master.Question.Model.ChoiceGroup,r=JSON.parse(e.GradingBasis).map((function(e){return s.findWhere(t,{Key:e})})).filter((function(e){return!!e})).map((function(e){return e&&e.Description})).join(this.props.LocalizedStrings.VariousLocations_ItemList_Separator),i=Object(l.b)("office-form-right-answerkey","various-short-text-correct-answer-list-correctness-icon","forms-icon-size14x14"),n=Object(m.b)({HTMLAttributes:{"aria-hidden":!0,className:i,role:"presentation"},IconName:"CheckMark"});return o.createElement("div",{className:"various-short-text-correct-answer-list",key:"correctAnswerList"},n,o.createElement("b",null,this.props.LocalizedStrings.VariousLocations_CorrectAnswerList_Label," "),r)}},r.shouldHideCorrectAnswerList=function(){var e=this.props.Master.Question.Model,t=this.props.Master.Model.QuizResult;return!(!this.props.ShowDesignInfo&&e.IsQuiz)||!(t&&!t.IsAnswerCorrect)},r.onKeyDown=function(e){var t=this.rankingRef.current;if(-1!==this.selectedIndex&&t){var r=t.children,i=r.length,o=this.selectedIndex+i,s=void 0;switch(e.keyCode){case 38:this.focusStatus=-1,(s=r[--o%i])&&s.firstElementChild.focus();break;case 40:this.focusStatus=-1,(s=r[++o%i])&&s.firstElementChild.focus()}}},r.updateFocusStatus=function(){var e=this.selectedIndex,t=this.rankingRef.current;if(t){var r=t.children[e];if(r)if(0===this.focusStatus)r.firstElementChild.focus();else{var i=".office-form-sort-list-arrows > button:nth-child("+((1===this.focusStatus?0===e?1:0:r===t.lastElementChild?0:1)+1)+")";r.querySelector(i).focus()}}this.focusStatus=-1},r.updateChoicesInternally=function(){var e=this.props.Master,t=e.Question.Model,r=e.Model.Answer;r&&r.length>0?this.choices=s.clone(r).sort((function(e,t){return e.answerOrder-t.answerOrder})).map((function(e){return s.find(t.ChoiceGroup,(function(t){return t.Id===e.id}))||{Description:e.displayText,Id:e.id,Key:e.key,Order:e.order}})):this.props.ShowDesignInfo||!t.IsQuiz||this.props.ShowQuizResult?this.choices=n.a.convertToArray(t.ChoiceGroup).sort((function(e,t){return e.Order-t.Order})):this.choices=s.shuffle(t.ChoiceGroup)},r.moveElement=function(e,r){var i=this.props.Master.Question.Model.ChoiceGroup;if(!(n.a.convertToArray(i).map(u.b).filter((function(e){return!e.isFieldReady(e.Schema.Id)})).length>0)){var o=this.choices.splice(e,1)[0];this.choices.splice(r,0,o),this.selectedIndex=r,this.props.Master.Model.Answer=t.stringifyAnswer(this.choices),this.forceUpdate()}},t}(r(210).a)}}]);